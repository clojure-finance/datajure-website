<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Datajure: Syntax Design</title>
        
<meta name="keywords" content="">

<meta name="description" content="With the foundation of the query being developed, I could start working on the syntax design itself. The syntax design is flexible with the help of macros. We could develop a syntax for our DSL as long as it is recognised by the Clojure language (i.e. following some fundamental rules and syntax imposed by Clojure).Clojure has a heavy use of expressions in the language. Every expression is separated and seen as a separate object to Clojure. It could not phrase or recognise syntax like DT[, col1,col2] - Clojure cannot extract the keywords like col1 and col2 here. In other words, spacing is very important in Clojure, every expression is separated by a space. It is a fundamental syntax of Clojure. This is the biggest limitation imposed by Clojure.">

<meta property="og:description" content="With the foundation of the query being developed, I could start working on the syntax design itself. The syntax design is flexible with the help of macros. We could develop a syntax for our DSL as long as it is recognised by the Clojure language (i.e. following some fundamental rules and syntax imposed by Clojure).Clojure has a heavy use of expressions in the language. Every expression is separated and seen as a separate object to Clojure. It could not phrase or recognise syntax like DT[, col1,col2] - Clojure cannot extract the keywords like col1 and col2 here. In other words, spacing is very important in Clojure, every expression is separated by a space. It is a fundamental syntax of Clojure. This is the biggest limitation imposed by Clojure.">

<meta property="og:url" content="https://clojure-finance.github.io/datajure-website/datajure-website/posts-output/2022-02-26-syntax-design/" />
<meta property="og:title" content="Syntax Design" />
<meta property="og:type" content="article" />

        <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
        
        <link rel="shortcut icon" href="images/ico/favicon.png">
        <link href="https://fonts.googleapis.com/css2?family=Fira+Code&family=Titillium+Web:wght@400;700&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Titillium+Web:wght@400;700&display=swap" rel="stylesheet">
        <link href="/datajure-website/css/normalize.css" rel="stylesheet" type="text/css" />
        <link href="/datajure-website/css/blog.css" rel="stylesheet" type="text/css" />
        <link href="/datajure-website/css/lotus-highlightjs.min.css" rel="stylesheet" type="text/css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/default.min.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/clojure.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/plaintext.min.js"></script>
    </head>
    <body>
        <aside id="sidebar">
            <div id="logo">
                <a title="Datajure" href="/datajure-website/">
                    <div class="title-text text desktop-and-tablet-only">
                        <i class="desktop-and-tablet-only fa fa-table"></i>
                        <br/><br/>
                        Datajure
                    </div>
                    <div class="title-text text mobile-only">Datajure</div>
                </a>
            </div> 

            <nav id="sidebar-links">
                <nav id="menucont">
                    <ul class="menu">
                        <li ><a title="Home" href="/datajure-website/"><div class="menu-item-text">Home</div></a></li>
                        
                        <li >
                            <a href="/datajure-website/pages-output/docs/"><div class="menu-item-text">Docs</div></a>
                        </li>
                        
                        <li >
                            <a href="/datajure-website/pages-output/examples/"><div class="menu-item-text">Examples</div></a>
                        </li>
                        
                        <li ><a title="Archives" href="/datajure-website/archives/"><div class="menu-item-text">Archives</div></a></li>
                    </ul>
                </nav>

                <nav id="socialmedia">
                    <ul>
                        <li><a target="_blank" title="RSS" href="/datajure-website/feed.xml" rel="external"><i class="icon fa-solid fa-rss"></i></a></li>
                        <li><a target="_blank" title="GitHub" href="https://github.com/clojure-finance/datajure" rel="external"><i class="icon fa-brands fa-github"></i></a></li>
                    </ul>
                </nav>
            </nav>
        </aside>

        <article id="main">
            
<div id="post">
    <div class="post-header">
    <div id="post-meta">
        <h1>Syntax Design</h1>
        <div class="byline">
            <span class="date">2022-02-26</span>
            
            <span class="author">By: Parry CHOI Chong Hing</span>
            
        </div>
    </div>
</div>
<div>
    
    <p>With the foundation of the query being developed, I could start working on the syntax design itself. The syntax design is flexible with the help of macros. We could develop a syntax for our DSL as long as it is recognised by the Clojure language (i.e. following some fundamental rules and syntax imposed by Clojure).</p><p>Clojure has a heavy use of expressions in the language. Every expression is separated and seen as a separate object to Clojure. It could not phrase or recognise syntax like <code>DT[, col1,col2]</code> - Clojure cannot extract the keywords like <code>col1</code> and <code>col2</code> here. In other words, spacing is very important in Clojure, every expression is separated by a space. It is a fundamental syntax of Clojure. This is the biggest limitation imposed by Clojure.</p><p>The design of the query syntax has three main parts:</p><ol><li><p>Separation between the selections: How can Clojure recognise the sections of the query (i.e rows, columns, group by and other functions)?</p></li><li><p>Aggregate Functions: How can we nest the aggregated columns in the syntax?</p></li><li><p>Filtering Functions: How can we nest the filtering function in the syntax?</p></li></ol><p>These three parts would largely determine the final syntax of the DSL. A few versions have been developed during the process. Here shows some of the main breakthroughs in the process:</p><ol><li><p><u>Separation between the selections</u></p><p>With the help of macros, indeed, it would not be a big problem. We could simply add a symbol in between to note the separation (like the comma in other languages). However, it is important to note that, for the symbol and the syntax being recognised by Clojure, the symbol should be regarded as a separate expression. For example, here is the first version of the separation syntax:</p><pre><code>dt-get DT '[row_filtering , column_selection , group_by_operation]
</code></pre><p>It is easy to notice that the comma is used as the symbol. It has a space in front and after the comma, making it a valid distinct expression in the syntax. However, it is later found that the comma is not recognized by Clojure - it would simply ignore its existence. Instead, the <code>&amp;</code> symbol is used instead. The final version is the following:</p><pre><code>dt-get DT '[row_filtering &amp; column_selection &amp; group_by_operation].
</code></pre></li><li><p><u>Aggregate Functions</u></p><p>Aggregate Functions is tricky. At first glance, it seems to be a function (and perhaps it <em><strong>is</strong></em> a function in other languages). However, in our case, with the foundation we have, it is just a special column selection. It is, in fact, the same as selecting other columns in the pipeline created. So, it is simplified to be a recognition problem in our case. In other words, to our DSL, all it needs to know is the aggregating operation and column being applied, no function is involved. Therefore, a simple design of the following is applied:</p><p>Aggregate Column: <code>[aggregate_keyword column_applied]</code></p><p>Normal Column: <code>column_name</code></p><p>However, I think the use of nested bracket make it complicated (as least looked complicated) and user-unfriendly. So I decided to do a simple aggregate keyword scan to find the aggregate column which ultimately eliminates the use of brackets. Nice!</p></li><li><p><u>Filtering Functions</u></p><p>Filtering is <em>powerful</em> in Clojure. Normal filtering in a typical query would be simple; for example, <code>col1 &lt; 2000 or col2 != 20</code>. It is due to the limitation of the filtering provided by other languages. In Clojure, however, the filtering function has no restrictions, as long as it returns a boolean result. That is something we have not seen in other data processing libraries (at least most of them). Such powerful ability of Clojure has given me a huge incentive not to limit users' ability in using such filtering function. So, the design of the filtering functions is, perhaps complicated, the following:</p><p><code>[column filtering_function]</code></p><p>The filtering_function is simply the built-in function in Clojure. It would be Clojure-like and, in fact, easy to use, even though it may seem a bit complicated at first.</p></li></ol><p><u>The Final Design</u><br />
Here shows the final design for the DSL syntax:</p><pre><code class="clojure">dt-get DT '[[col1 filtering_function1] [agg_keyword col2 filtering_function2] &amp; col1 agg_keyword col2 &amp; col3 col4]
</code></pre>
</div>

<br/>


    
    <div id="prev-next">
    
    <a class="prev" href="/datajure-website/posts-output/2022-03-12-sort-by-function-implementation/"><i class="fa-solid fa-circle-left"></i><div class="nav-text">Sort-by Function Implementation</div></a>
    
    
    <a class="next" href="/datajure-website/posts-output/2022-01-29-implementation-of-query-foundation/"><div class="nav-text"">Implementation of Query Foundation</div><i class="fa-solid fa-circle-right"></i></a>
    
</div>

    

    


</div>

            <br/>
            <div id="footercont">
                Copyright &copy; 2023 Datajure
                <br>Powered by <a href="http://cryogenweb.org">Cryogen</a>
            </div>
        </article>

        <script src="/datajure-website/js/highlight.pack.js" type="application/javascript"></script>
        <script>hljs.initHighlightingOnLoad();</script>
        <script src="/datajure-website/js.dropdown.js" type="application/javascript"></script> 
        

        
        
    </body>
</html>
