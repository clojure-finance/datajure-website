<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Datajure: Clojask Backend Implementation</title>
        
<meta name="keywords" content="">

<meta name="description" content="Clojask is an open-source library for parallel computing of larger-than-memory datasets developed at HKU Business School.Clojask relies on Onyx for parallel computing. In Datajure, we set the number of workers to 8, which does not support manual modification by users.">

<meta property="og:description" content="Clojask is an open-source library for parallel computing of larger-than-memory datasets developed at HKU Business School.Clojask relies on Onyx for parallel computing. In Datajure, we set the number of workers to 8, which does not support manual modification by users.">

<meta property="og:url" content="https://clojure-finance.github.io/datajure-website/datajure-website/posts-output/2023-09-02-clojask-backend/" />
<meta property="og:title" content="Clojask Backend Implementation" />
<meta property="og:type" content="article" />

        <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
        
        <link rel="shortcut icon" href="images/ico/favicon.png">
        <link href="https://fonts.googleapis.com/css2?family=Fira+Code&family=Titillium+Web:wght@400;700&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Titillium+Web:wght@400;700&display=swap" rel="stylesheet">
        <link href="/datajure-website/css/normalize.css" rel="stylesheet" type="text/css" />
        <link href="/datajure-website/css/blog.css" rel="stylesheet" type="text/css" />
        <link href="/datajure-website/css/lotus-highlightjs.min.css" rel="stylesheet" type="text/css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/default.min.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/clojure.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/plaintext.min.js"></script>
    </head>
    <body>
        <aside id="sidebar">
            <div id="logo">
                <a title="Datajure" href="/datajure-website/">
                    <div class="title-text text desktop-and-tablet-only">
                        <i class="desktop-and-tablet-only fa fa-table"></i>
                        <br/><br/>
                        Datajure
                    </div>
                    <div class="title-text text mobile-only">Datajure</div>
                </a>
            </div> 

            <nav id="sidebar-links">
                <nav id="menucont">
                    <ul class="menu">
                        <li ><a title="Home" href="/datajure-website/"><div class="menu-item-text">Home</div></a></li>
                        
                        <li >
                            <a href="/datajure-website/pages-output/docs/"><div class="menu-item-text">Docs</div></a>
                        </li>
                        
                        <li >
                            <a href="/datajure-website/pages-output/examples/"><div class="menu-item-text">Examples</div></a>
                        </li>
                        
                        <li ><a title="Archives" href="/datajure-website/archives/"><div class="menu-item-text">Archives</div></a></li>
                    </ul>
                </nav>

                <nav id="socialmedia">
                    <ul>
                        <li><a target="_blank" title="RSS" href="/datajure-website/feed.xml" rel="external"><i class="icon fa-solid fa-rss"></i></a></li>
                        <li><a target="_blank" title="GitHub" href="https://github.com/clojure-finance/datajure" rel="external"><i class="icon fa-brands fa-github"></i></a></li>
                    </ul>
                </nav>
            </nav>
        </aside>

        <article id="main">
            
<div id="post">
    <div class="post-header">
    <div id="post-meta">
        <h1>Clojask Backend Implementation</h1>
        <div class="byline">
            <span class="date">2023-09-02</span>
            
            <span class="author">By: YANG Ming-Tian</span>
            
        </div>
    </div>
</div>
<div>
    <ul class="toc"><li><a href="#dataset-construction">Dataset Construction</a></li><li><a href="#row-selection">Row Selection</a></li><ul><li><a href="#row-selection-by-filter">Row Selection by Filter</a></li><li><a href="#row-selection-by-index">Row Selection by Index</a></li></ul><li><a href="#column-selection">Column Selection</a></li><li><a href="#optional-selection">Optional Selection</a></li><ul><li><a href="#group-by">Group by</a></li><li><a href="#sort-by">Sort by</a></li></ul><li><a href="#aggregate-function">Aggregate Function</a></li></ul>
    <p>Clojask is an open-source library for parallel computing of larger-than-memory datasets developed at HKU Business School.</p><p>Clojask relies on Onyx for parallel computing. In Datajure, we set the number of workers to 8, which does not support manual modification by users.</p><p>Unlike other backends that return modified datasets, Clojask's API will make modifications directly on the original dataset. In order to simplify the code logic, we always manually return the reference of the original data set when writing internal functions.</p><p>The operation of Clojask backend involves a lot of file reading and writing. Excessive file manipulation is tiring. In addition, the data type information may be lost during the file reading and writing process, and thus the data type needs to be respecified. Therefore, it is recommended to use the Clojask backend only when the dataset to be processed is larger than the memory.</p><p>For convenience, we store the temporary files generated during data processing in the <code>./.dsl/</code> directory. If these files are no longer needed, you can delete them manually.</p><p>Detailed documentations of Clojask can be found on its <a href="https://clojure-finance.github.io/clojask-website/">official website</a>.</p><h2 id="dataset-construction">Dataset Construction</h2><p>Datajure provides a function <code>dataset</code> to construct a Clojask dataset from an associative map. See <a href="/datajure-website/pages-output/examples/">Examples</a> for specific usage.</p><p>However, since Clojask's data operations are highly dependent on external files, constructing data directly within the program may lead to unexpected errors. Therefore, you are highly recommended to read the dataset from a file using <code>ck/dataframe</code>.</p><p><strong>Example</strong></p><pre><code class="clojure">;; defines df as a dataframe from dataframe.csv file
(def df (ck/dataframe "resources/Employee.csv"))
</code></pre><p>If customized seperators or different file formats are used, please first read and parse the file using <code>clojask-io.input/read-file</code>, and then pass it to <code>ck/dataframe</code>.</p><p><strong>Example</strong></p><pre><code class="clojure">;; define df to be a dataframe with customized seperator
(require '[clojask-io.input :as input])
(def df (ck/dataframe (fn [] (input/read-file "resources/Employees.csv" :sep "," :output true :stat true))))
</code></pre><p>For more details of <code>ck/dataframe</code>, please refer to the <a href="https://clojure-finance.github.io/clojask-website/posts-output/API/#dataframe">official document</a> of Clojask.</p><p>For more details of <code>clojask-io</code> please refer to its <a href="https://github.com/clojure-finance/clojask-io">GitHub repo</a>.</p><p>By default, all the column types are string. In order to perform subsequent operations correctly, specifying the type of data in each column is an essential step. To do so, please use the <a href="https://clojure-finance.github.io/clojask-website/posts-output/API/#set-type"><code>ck/set-type</code></a> function provided by Clojask.</p><p><strong>Example</strong></p><pre><code class="clojure">;; set data type of the column "Salary" to be double 
(set-type x "Salary" "double")
</code></pre><p>The natively supported types are: <code>int</code>, <code>double</code>, <code>string</code>, <code>date</code>.</p><p>If you need a special parsing function, please use <a href="https://clojure-finance.github.io/clojask-website/posts-output/API/#set-parser"><code>ck/set-parser</code></a>.</p><p><strong>Example</strong></p><pre><code class="clojure">;; parse all the values in "Salary" with this function
(set-parser x "Salary" #(Double/parseDouble %))
</code></pre><h2 id="row-selection">Row Selection</h2><h3 id="row-selection-by-filter">Row Selection by Filter</h3><p>The filter operation is implemented with the <code>ck/filter</code> function provided by Clojask. When multiple filters are provided, we use <code>doall</code> and <code>map</code> to repeatedly apply <code>ck/filter</code>.</p><h3 id="row-selection-by-index">Row Selection by Index</h3><p>Since row selection by index is not natively supported by Clojask and the order of the rows in the dataset is not guaranteed, the users are highly suggested to manually add a column for indices and then perform filter operations on that column.</p><h2 id="column-selection">Column Selection</h2><p>The column selection operations are implemented with the <code>ck/compute</code> function in Clojask. The result will be stored in <code>./.dsl/select-result.csv</code>.</p><h2 id="optional-selection">Optional Selection</h2><h3 id="group-by">Group by</h3><p>The grouping by operation is implemented using the <code>ck/group-by</code> function provided by Clojask, which accepts a regular dataset and returns a grouped dataset. The grouped dataset will then be handled by <code>calc-stats</code> to perform aggregate functions. The result will be computed using <code>ck/compute</code> in <code>./.dsl/group-by-result.csv</code>, and then reloaded.</p><p>In order to perform subsequent operations correctly, you are highly suggested to respecify the type of data after reloading.</p><h3 id="sort-by">Sort by</h3><p>The sorting operation is not well supported by Clojask. Therefore, we have implemented an <code>external-sort</code> function using <a href="https://github.com/lemire/externalsortinginjava">Externalsortinginjava</a>. Temporary input and output are stored in <code>./.dsl/sort-input.csv</code> and <code>./.dsl/sort-output.csv</code> respectively.</p><p>Since this third-party library has limited support for custom comparators, we defined <code>cmp-gen</code> to convert user-written comparators into the form required by the library. This function only supports comparing data of type <code>int</code>.</p><p>In order to perform subsequent operations correctly, you are highly suggested to respecify the type of data after reloading.</p><h2 id="aggregate-function">Aggregate Function</h2><p>We use the <code>ck/aggregate</code> function to calculate statistical data of relevant columns when performing grouping by operations.</p><p>We defined the <code>get-agg-name</code> function to solve the naming problem of aggregated columns.</p>
</div>

<br/>


    
    <div id="prev-next">
    
    <a class="prev" href="/datajure-website/posts-output/2023-09-08-geni-backend/"><i class="fa-solid fa-circle-left"></i><div class="nav-text">Geni Backend Implementation</div></a>
    
    
    <a class="next" href="/datajure-website/posts-output/2023-08-31-tablecloth-backend/"><div class="nav-text"">Tablecloth Backend Implementation</div><i class="fa-solid fa-circle-right"></i></a>
    
</div>

    

    


</div>

            <br/>
            <div id="footercont">
                Copyright &copy; 2023 Datajure
                <br>Powered by <a href="http://cryogenweb.org">Cryogen</a>
            </div>
        </article>

        <script src="/datajure-website/js/highlight.pack.js" type="application/javascript"></script>
        <script>hljs.initHighlightingOnLoad();</script>
        <script src="/datajure-website/js.dropdown.js" type="application/javascript"></script> 
        

        
        
    </body>
</html>
